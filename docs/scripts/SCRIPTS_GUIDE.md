# Phase 5 é™„åŠ å†…å®¹ï¼šæ„å»ºæµ‹è¯•è„šæœ¬

## æ–°å¢è„šæœ¬

ä¸ºäº†ä¾¿æ·é¡¹ç›®æ„å»ºä¸æµ‹è¯•ï¼Œæ·»åŠ äº†ä»¥ä¸‹è„šæœ¬ï¼š

### 1. build_and_test.shï¼ˆä¸»è¦è„šæœ¬ï¼‰

åŠŸèƒ½å®Œæ•´çš„æ„å»ºä¸æµ‹è¯•è„šæœ¬ï¼Œæ”¯æŒå¤šç§é€‰é¡¹ç»„åˆã€‚

**ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨é…ç½® CMake
- âœ… æ™ºèƒ½å¹¶è¡Œç¼–è¯‘æ§åˆ¶
- âœ… åˆ†ç¦»è¿è¡Œå•å…ƒ/é›†æˆæµ‹è¯•
- âœ… ç¤ºä¾‹ç¨‹åºæ„å»ºä¸æ‰§è¡Œ
- âœ… å½©è‰²è¾“å‡ºï¼Œæ¸…æ™°æ˜“è¯»
- âœ… æ”¯æŒé€‰æ‹©æ€§æµ‹è¯•

**å¸¸ç”¨å‘½ä»¤ï¼š**
```bash
./build_and_test.sh --all          # å®Œæ•´æ„å»ºä¸æ‰€æœ‰æµ‹è¯•
./build_and_test.sh --clean --unit # æ¸…ç©ºåä»…è¿è¡Œå•å…ƒæµ‹è¯•
./build_and_test.sh -j 4           # 4 æ ¸å¹¶è¡Œç¼–è¯‘
```

### 2. quick_test.shï¼ˆå¿«é€ŸéªŒè¯ï¼‰

æœ€å°åŒ–è„šæœ¬ï¼Œé€‚åˆé¢‘ç¹å¿«é€Ÿæ£€éªŒã€‚

**ç‰¹æ€§ï¼š**
- âš¡ ç¼–è¯‘ä¸æµ‹è¯•æ—¶é—´æœ€çŸ­
- ğŸ¯ ä»…åŒ…å«æ ¸å¿ƒæµ‹è¯•
- ğŸ“Š ç®€æ´çš„è¾“å‡ºæ ¼å¼

**ä½¿ç”¨ï¼š**
```bash
./quick_test.sh
```

### æ¸…ç†ï¼ˆåˆå¹¶åˆ° build_and_test.shï¼‰

æ¸…ç†åŠŸèƒ½å·²æ•´åˆåˆ° `build_and_test.sh --clean`ï¼šäº¤äº’å¼ç»ˆç«¯ä¼šæ˜¾ç¤ºå°†è¦åˆ é™¤çš„ç›®å½•å¹¶è¦æ±‚ç¡®è®¤ï¼›åœ¨éäº¤äº’ç¯å¢ƒä¸‹æˆ–è®¾ç½® `FORCE_CLEAN=1` æ—¶ä¼šç›´æ¥æ‰§è¡Œåˆ é™¤ï¼ˆä¾¿äº CIï¼‰ã€‚

**ç¤ºä¾‹ï¼š**
```bash
# äº¤äº’å¼æ¸…ç†
./build_and_test.sh --clean

# éäº¤äº’æˆ–å¼ºåˆ¶æ¸…ç†
FORCE_CLEAN=1 ./build_and_test.sh --clean
```

### 4. analyze_tests.pyï¼ˆPython åˆ†æå·¥å…·ï¼‰

ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šä¸ JSON æ•°æ®ã€‚

**ç‰¹æ€§ï¼š**
- ğŸ“Š è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- ğŸ“‹ ç”Ÿæˆ JSON æ ¼å¼æŠ¥å‘Š
- ğŸ“ˆ ç»Ÿè®¡æµ‹è¯•è¦†ç›–
- ğŸ• è®°å½•æ‰§è¡Œæ—¶é—´

**ä½¿ç”¨ï¼š**
```bash
python3 analyze_tests.py [build_dir]
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
============================================================
ğŸ“Š æµ‹è¯•æŠ¥å‘Š
============================================================
æ€»ä½“çŠ¶æ€: PASSED
æµ‹è¯•æ€»æ•°: 12
é€šè¿‡æ•°: 12
å¤±è´¥æ•°: 0

å•å…ƒæµ‹è¯•: 7/7 é€šè¿‡
é›†æˆæµ‹è¯•: 2/2 é€šè¿‡
ç¤ºä¾‹ç¨‹åº: 3/3 é€šè¿‡
============================================================
```

## ä½¿ç”¨åœºæ™¯

### æ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹
```bash
./quick_test.sh
```

### æ—¥å¸¸å¼€å‘
```bash
# ä¿®æ”¹ä»£ç åå¿«é€ŸéªŒè¯
./quick_test.sh

# æäº¤å‰å®Œæ•´æ£€æŸ¥
./build_and_test.sh --all
```

### æŒç»­é›†æˆ
```bash
# CI æµç¨‹
./build_and_test.sh --clean --all
python3 analyze_tests.py build
```

### æ¸…ç†ä¸é‡å»º
```bash
./clean.sh
./build_and_test.sh --clean --all
```

## è„šæœ¬æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç±»å‹ | å¤§å° | åŠŸèƒ½ |
|------|------|------|------|
| build_and_test.sh | Bash | ~6KB | å®Œæ•´æ„å»ºæµ‹è¯•æ§åˆ¶ |
| quick_test.sh | Bash | ~1KB | å¿«é€ŸéªŒè¯ |
| clean.sh | Bash | ~0.5KB | æ¸…ç†äº§ç‰© |
| analyze_tests.py | Python3 | ~4KB | æµ‹è¯•åˆ†ææŠ¥å‘Š |
| BUILD_AND_TEST.md | æ–‡æ¡£ | ~6KB | è¯¦ç»†ä½¿ç”¨æŒ‡å— |

## æŠ€æœ¯ç»†èŠ‚

### è„šæœ¬ç‰¹æ€§

1. **å½©è‰²è¾“å‡º** - æ˜“äºè¯†åˆ«æˆåŠŸ/å¤±è´¥
   ```
   âœ“ æˆåŠŸ (ç»¿è‰²)
   âœ— å¤±è´¥ (çº¢è‰²)
   => æ­¥éª¤ (è“è‰²)
   ! è­¦å‘Š (é»„è‰²)
   ```

2. **é”™è¯¯å¤„ç†** - é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º
   ```bash
   set -e  # ä»»ä½•å‘½ä»¤å¤±è´¥åˆ™é€€å‡º
   ```

3. **å¹¶è¡Œæ§åˆ¶** - è‡ªé€‚åº” CPU æ ¸å¿ƒæ•°
   ```bash
   PARALLEL=$(nproc)  # è‡ªåŠ¨æ£€æµ‹
   ```

4. **æµ‹è¯•ç»Ÿè®¡** - è·Ÿè¸ªæˆåŠŸ/å¤±è´¥æ•°
   ```bash
   failed_tests=()    # è®°å½•å¤±è´¥çš„æµ‹è¯•
   ```

## é›†æˆå»ºè®®

### Git hooks é›†æˆ

åœ¨ `.git/hooks/pre-commit` ä¸­ï¼š
```bash
#!/bin/bash
./quick_test.sh || exit 1
```

### GitHub Actions é›†æˆ

```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: recursive
      - name: Quick Test
        run: ./quick_test.sh
      - name: Full Test
        run: ./build_and_test.sh --all
```

### Docker é›†æˆ

```dockerfile
FROM ubuntu:22.04
WORKDIR /app
COPY . .
RUN apt-get update && apt-get install -y cmake build-essential python3
RUN ./quick_test.sh
```

## å¸¸è§é—®é¢˜

**Q: è„šæœ¬æ— æ³•æ‰§è¡Œï¼Ÿ**
```bash
chmod +x *.sh analyze_tests.py
```

**Q: Python è„šæœ¬æŠ¥é”™ï¼Ÿ**
```bash
# ç¡®ä¿å®‰è£…äº† Python 3.6+
python3 --version
```

**Q: ç¼–è¯‘å¹¶è¡Œæ•°è®¾ç½®ä¸å½“å¯¼è‡´å†…å­˜ä¸è¶³ï¼Ÿ**
```bash
# ä½¿ç”¨æ›´å°‘çš„æ ¸å¿ƒ
./build_and_test.sh -j 2
```

**Q: æƒ³ä¿ç•™æ—§çš„æ„å»ºä½†é‡æ–°ç¼–è¯‘ï¼Ÿ**
```bash
# ä¸ä½¿ç”¨ --clean
./build_and_test.sh --unit
```

## æœªæ¥ä¼˜åŒ–ç©ºé—´

- [ ] æ”¯æŒ Ninja æ„å»ºç³»ç»Ÿ
- [ ] æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] é›†æˆä»£ç è¦†ç›–ç‡åˆ†æ
- [ ] ç”Ÿæˆ HTML æ ¼å¼çš„æŠ¥å‘Š
- [ ] æ”¯æŒ Windows batch è„šæœ¬ç‰ˆæœ¬
- [ ] å¹¶è¡Œè¿è¡Œç‹¬ç«‹æµ‹è¯•

## æ€»ç»“

è¿™ç»„è„šæœ¬æä¾›äº†ä»å¿«é€ŸéªŒè¯åˆ°å®Œæ•´åˆ†æçš„å®Œæ•´å·¥å…·é“¾ï¼Œå¤§å¹…ç®€åŒ–äº†é¡¹ç›®çš„æ—¥å¸¸å¼€å‘å’Œ CI/CD é›†æˆã€‚

**æ¨èæµç¨‹ï¼š**
1. å¿«é€Ÿæ£€æŸ¥ï¼š`./quick_test.sh`
2. æäº¤å‰ï¼š`./build_and_test.sh --all`
3. åˆ†ææŠ¥å‘Šï¼š`python3 analyze_tests.py build`
