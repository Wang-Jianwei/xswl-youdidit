# xswl-youdidit

ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»»åŠ¡ä»£ç†å¹³å°åº“ï¼Œé‡‡ç”¨èµé‡‘æ¦œæ¸¸æˆæœºåˆ¶ï¼Œæ”¯æŒå¤šè§’è‰²ä»»åŠ¡äº¤äº’ä¸å®æ—¶ç›‘æ§ã€‚

## ğŸ“– ç›®å½•

- [ğŸ“‹ é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
- [ğŸ› ï¸ æŠ€æœ¯æ ˆ](#ï¸-æŠ€æœ¯æ ˆ)
- [âœ¨ æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [â˜ï¸ GitHub Codespaces](#-åœ¨-codespaces-ä¸­å¿«é€Ÿå¼€å§‹)
- [ğŸ—ï¸ é¡¹ç›®ç»“æ„](#ï¸-é¡¹ç›®ç»“æ„)
- [ğŸ“– æ ¸å¿ƒæ¦‚å¿µ](#-æ ¸å¿ƒæ¦‚å¿µ)
- [ğŸ’¡ ä¸»è¦ç‰¹æ€§è¯¦è§£](#-ä¸»è¦ç‰¹æ€§è¯¦è§£)
- [ğŸ” çº¿ç¨‹å®‰å…¨è®¾è®¡](#-çº¿ç¨‹å®‰å…¨è®¾è®¡)
- [ğŸ” ä¿¡å·æ§½æœºåˆ¶](#-ä¿¡å·æ§½æœºåˆ¶è¯¦è§£)
- [ğŸ“Š ç›‘æ§ä¸å¯è§†åŒ–](#-ç›‘æ§ä¸å¯è§†åŒ–)
- [ğŸ“¦ ä¾èµ–åº“](#-ä¾èµ–åº“)
- [ğŸ“ ä½¿ç”¨ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹)
- [ğŸ¤ è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)
- [ğŸ“„ è®¸å¯è¯](#-è®¸å¯è¯)

---

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

**xswl-youdidit** æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†å¸ƒå¼å¤„ç†å¹³å°ï¼Œæ¨¡æ‹ŸçœŸå®ä¸–ç•Œçš„èµé‡‘æ¦œç³»ç»Ÿã€‚é€šè¿‡æ¸¸æˆåŒ–çš„ä»»åŠ¡äº¤äº’æœºåˆ¶ï¼Œæ”¯æŒä»»åŠ¡å‘å¸ƒè€…ã€ç”³é¢†è€…ã€åˆ†æ´¾è€…ç­‰å¤šè§’è‰²åä½œï¼Œå®ç°é«˜æ•ˆçš„å¼‚æ­¥ä»»åŠ¡å¤„ç†ä¸çŠ¶æ€è¿½è¸ªã€‚

### è®¾è®¡ç†å¿µ

- **æ¸¸æˆåŒ–æœºåˆ¶**ï¼šå€Ÿé‰´èµé‡‘æ¦œæ¸¸æˆæ¨¡å¼ï¼Œä½¿ä»»åŠ¡äº¤äº’æ›´åŠ ç›´è§‚æœ‰è¶£
- **å®æ—¶ç›‘æ§**ï¼šå®Œæ•´çš„æ—¥å¿—è®°å½•å’Œ Web å¯è§†åŒ–å·¥å…·ï¼Œæ”¯æŒæ—¶é—´å›æ”¾åŠŸèƒ½
- **é«˜æ€§èƒ½å¹¶å‘**ï¼šæ”¯æŒå¤§è§„æ¨¡å¹¶å‘ä»»åŠ¡å¤„ç†å’ŒåŠ¨æ€è°ƒåº¦

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **ç¼–ç¨‹è¯­è¨€**: C++11
- **ç¼–è¯‘å·¥å…·**: CMake
- **ç¼–è¯‘å™¨**: MinGW
- **ä¾èµ–åº“**: tl::optionalã€tl::expected ç­‰ç¬¬ä¸‰æ–¹åº“

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ“¤ ä»»åŠ¡å‘å¸ƒä¸ç”³é¢†
- ä»»åŠ¡å‘å¸ƒè€…å¯ä»¥å‘å¸ƒä»»åŠ¡åˆ°å¹³å°
- æ”¯æŒç­‰å¾…ä»»åŠ¡ç”³é¢†ç»“æœã€å¤„ç†ç»“æœã€çŠ¶æ€åé¦ˆ
- ç”³é¢†è€…è´Ÿè´£å¤„ç†ä»»åŠ¡å¹¶åé¦ˆæ‰§è¡ŒçŠ¶æ€
- æ”¯æŒä»»åŠ¡åˆ†æ´¾ï¼Œå‘å¸ƒè€…å¯æŒ‡å®šç‰¹å®šå¤„ç†è€…

### âš¡ å¹¶å‘ä¸è°ƒåº¦
- æ”¯æŒä»»æ„å¤šä¸ªä»»åŠ¡ç”³é¢†è€…åŒæ—¶å¤„ç†å„ç§ä»»åŠ¡
- æ”¯æŒè®¾ç½®å’Œå®æ—¶è°ƒæ•´ä»»åŠ¡ä¼˜å…ˆçº§
- æ”¯æŒå¤šè§’è‰²å¹¶å‘äº¤äº’

### ğŸ›ï¸ æ¶æ„è®¾è®¡
- é‡‡ç”¨ä¿¡å·æ§½æœºåˆ¶ï¼ˆä½¿ç”¨ [xswl-signals](https://github.com/Wang-Jianwei/xswl-signals.git) åº“ï¼‰
- æ¸¸æˆåŒ–è®¾è®¡é£æ ¼ï¼Œç±»ä¼¼çœŸå®ä¸–ç•Œçš„èµé‡‘æ¦œæ¨¡å¼
- ä»£ç æ¥å£å‘½åè´´è¿‘èµé‡‘æ¦œæ¸¸æˆè§’è‰²

### ğŸ“Š ç›‘æ§ä¸æ—¥å¿—
- è®°å½•å„è§’è‰²äº¤äº’æ—¥å¿—å’ŒçŠ¶æ€åˆ°çŠ¶æ€æ–‡ä»¶
- æä¾› Web å·¥å…·å®æ—¶æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
- æ”¯æŒæ—¶é—´å›æ”¾åŠŸèƒ½ï¼Œå¦‚åŒæ¸¸æˆä»¿çœŸç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

> **ğŸ“Œ åœ¨ GitHub Codespaces ä¸­ï¼Ÿ** 
> æŸ¥çœ‹ [Codespaces ç”¨æˆ·æŒ‡å—](CODESPACES_GUIDE.md) äº†è§£å¦‚ä½•åœ¨äº‘ç«¯è¿è¡Œå’Œè®¿é—® Web ä»ªè¡¨æ¿ï¼

### å‰ç½®è¦æ±‚

- C++11 æˆ–æ›´é«˜ç‰ˆæœ¬
- CMake 3.10+
- GCC/Clang ç¼–è¯‘å™¨ï¼ˆæˆ– MinGW on Windowsï¼‰
- Python 3ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•ç»“æœåˆ†æï¼‰

### æ„å»ºé¡¹ç›®

```bash
# å…‹éš†ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/Wang-Jianwei/xswl-youdidit.git
cd xswl-youdidit

# åˆå§‹åŒ– git submoduleï¼ˆä¸‹è½½ xswl-signalsï¼‰
git submodule update --init --recursive
```

### ä½¿ç”¨æ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„æ„å»ºæµ‹è¯•è„šæœ¬ï¼š

#### å¿«é€Ÿæµ‹è¯•ï¼ˆæœ€å¿«ï¼‰
```bash
./quick_test.sh
```
å¿«é€Ÿç¼–è¯‘å¹¶è¿è¡Œæ ¸å¿ƒæµ‹è¯•å¥—ä»¶ã€‚

#### å®Œæ•´æ„å»ºä¸æµ‹è¯•
```bash
./build_and_test.sh [é€‰é¡¹]
```

**é€‰é¡¹è¯´æ˜ï¼š**
- `--help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `--clean` - æ¸…ç©ºæ„å»ºç›®å½•å¹¶é‡æ–°æ„å»º
- `--unit` - ä»…è¿è¡Œå•å…ƒæµ‹è¯•
- `--integration` - ä»…è¿è¡Œé›†æˆæµ‹è¯•
- `--examples` - æ„å»ºå¹¶è¿è¡Œç¤ºä¾‹ç¨‹åº
- `--all` - è¿è¡Œæ‰€æœ‰æµ‹è¯•ä¸ç¤ºä¾‹
- `-j N` - æŒ‡å®šå¹¶è¡Œæ„å»ºæ•°ï¼ˆé»˜è®¤ä¸º CPU æ ¸å¿ƒæ•°ï¼‰

**ç¤ºä¾‹ï¼š**
```bash
# æ¸…ç©ºåå®Œæ•´æ„å»ºä¸æµ‹è¯•
./build_and_test.sh --clean --all

# ä»…è¿è¡Œå•å…ƒæµ‹è¯•
./build_and_test.sh --unit

# ä½¿ç”¨ 4 ä¸ªçº¿ç¨‹ç¼–è¯‘
./build_and_test.sh -j 4
```

#### æ¸…ç†æ„å»ºäº§ç‰©
```bash
./clean.sh
```

#### è¯¦ç»†çš„æµ‹è¯•åˆ†æï¼ˆPythonï¼‰
```bash
python3 analyze_tests.py [æ„å»ºç›®å½•]
```
è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶å¹¶ç”Ÿæˆ JSON æ ¼å¼çš„è¯¦ç»†æŠ¥å‘Šã€‚

### æ‰‹åŠ¨æ„å»ºä¸æµ‹è¯•

å¦‚æœæ‚¨æ›´å€¾å‘äºæ‰‹åŠ¨æ“ä½œï¼š

```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build
cd build

# é…ç½® CMake
cmake ..

# ç¼–è¯‘ï¼ˆä½¿ç”¨å¤šæ ¸åŠ é€Ÿï¼‰
make -j$(nproc)

# è¿è¡Œå•å…ƒæµ‹è¯•
./tests/test_types
./tests/test_task
./tests/test_claimer
./tests/test_task_platform
./tests/test_web

# è¿è¡Œé›†æˆæµ‹è¯•
./tests/integration_test_workflow
./tests/integration_test_web_api

# è¿è¡Œç¤ºä¾‹
./examples/example_basic_usage
./examples/example_multi_claimer
./examples/example_web_monitoring

# æˆ–ä½¿ç”¨ CTest è¿è¡Œæ‰€æœ‰æµ‹è¯•
ctest --output-on-failure
```

**ç¼–è¯‘è¦æ±‚**:
- CMake 3.10+
- C++11 ç¼–è¯‘å™¨ï¼ˆGCC 4.8+, Clang 3.4+, MSVC 2015+, MinGWï¼‰
- Gitï¼ˆç”¨äºä¸‹è½½ submoduleï¼‰

## â˜ï¸ åœ¨ Codespaces ä¸­å¿«é€Ÿå¼€å§‹

å¦‚æœæ‚¨åœ¨ GitHub Codespaces ä¸­å·¥ä½œï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ Web ä»ªè¡¨æ¿ï¼

```bash
# å¯åŠ¨ Web ä»ªè¡¨æ¿æ¼”ç¤ºï¼ˆå¸¦å‹å¥½çš„ UI æç¤ºï¼‰
./run_web_demo.sh

# ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
# - æœ¬åœ°ï¼šhttp://localhost:8080
# - Codespacesï¼šä½¿ç”¨ Ports è§†å›¾ä¸­çš„ç«¯å£è½¬å‘é“¾æ¥
```

è¯¦è§ [Codespaces ç”¨æˆ·æŒ‡å—](CODESPACES_GUIDE.md)ï¼Œäº†è§£ï¼š
- ğŸ“º å¦‚ä½•è®¿é—® Web ä»ªè¡¨æ¿
- ğŸ”Œ ç«¯å£è½¬å‘é…ç½®
- ğŸ› å¸¸è§é—®é¢˜æ’é™¤
- ğŸ“¡ REST API ä½¿ç”¨

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **å‘å¸ƒä»»åŠ¡**ï¼šä»»åŠ¡å‘å¸ƒè€…åˆ›å»ºä»»åŠ¡å¹¶æäº¤åˆ°å¹³å°
2. **ç”³é¢†ä»»åŠ¡**ï¼šå¤„ç†è€…æŸ¥çœ‹å¹¶ç”³é¢†åˆé€‚çš„ä»»åŠ¡
3. **æ‰§è¡Œå¤„ç†**ï¼šç”³é¢†è€…å¤„ç†ä»»åŠ¡å¹¶åé¦ˆçŠ¶æ€
4. **ç›‘æ§æŸ¥çœ‹**ï¼šé€šè¿‡ Web å·¥å…·å®æ—¶ç›‘æ§ä»»åŠ¡è¿›å±•å’Œç³»ç»ŸçŠ¶æ€

### è®¾è®¡æ¨¡å¼

é‡‡ç”¨ç°ä»£ C++ è®¾è®¡æ¨¡å¼ï¼š

- **Fluent API**ï¼šé“¾å¼è°ƒç”¨ï¼Œæé«˜ä»£ç å¯è¯»æ€§
- **æ™ºèƒ½æŒ‡é’ˆ**ï¼šè‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼
- **å‡½æ•°å¼å›è°ƒ**ï¼šä½¿ç”¨ Lambda è¡¨è¾¾å¼å¤„ç†äº‹ä»¶
- **Result ç±»å‹**ï¼šä½¿ç”¨ `tl::expected` è¿›è¡Œä¼˜é›…çš„é”™è¯¯å¤„ç†

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
xswl-youdidit/
â”œâ”€â”€ include/          # å¤´æ–‡ä»¶
â”œâ”€â”€ src/              # æºä»£ç å®ç°
â”œâ”€â”€ tests/            # æµ‹è¯•ä»£ç 
â”œâ”€â”€ web/              # Web ç›‘æ§å·¥å…·
â”œâ”€â”€ CMakeLists.txt    # æ„å»ºé…ç½®
â””â”€â”€ README.md         # æœ¬æ–‡ä»¶
```

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µ

### è®¾è®¡åŸåˆ™ï¼šèŒè´£åˆ†ç¦»

**å…³é”®è®¾è®¡ç†å¿µ**ï¼šä»»åŠ¡çš„ä¸šåŠ¡é€»è¾‘ç”±ä»»åŠ¡æœ¬èº«æºå¸¦ï¼Œç”³é¢†è€…åªè´Ÿè´£æ‰§è¡Œã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èŒè´£åˆ†ç¦»åŸåˆ™                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  å‘å¸ƒè€…ï¼ˆPublisherï¼‰                                    â”‚
â”‚  â”œâ”€ å®šä¹‰ä»»åŠ¡è¦åšä»€ä¹ˆï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰                         â”‚
â”‚  â”œâ”€ è®¾ç½®ä»»åŠ¡ä¼˜å…ˆçº§å’Œå…ƒæ•°æ®                              â”‚
â”‚  â””â”€ æŒ‡å®šæ‰€éœ€çš„æ‰§è¡Œè€…è§’è‰²/æŠ€èƒ½                           â”‚
â”‚                                                         â”‚
â”‚  ä»»åŠ¡ï¼ˆTaskï¼‰                                           â”‚
â”‚  â”œâ”€ æºå¸¦ä¸šåŠ¡å¤„ç†å‡½æ•°ï¼ˆhandlerï¼‰                          â”‚
â”‚  â”œâ”€ ç»´æŠ¤çŠ¶æ€å’Œè¿›åº¦ä¿¡æ¯                                  â”‚
â”‚  â””â”€ è§¦å‘ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¿¡å·                                â”‚
â”‚                                                         â”‚
â”‚  ç”³é¢†è€…ï¼ˆClaimerï¼‰                                      â”‚
â”‚  â”œâ”€ ç”³é¢†ç¬¦åˆè‡ªå·±èƒ½åŠ›çš„ä»»åŠ¡                              â”‚
â”‚  â”œâ”€ æ‰§è¡Œä»»åŠ¡å®šä¹‰çš„ä¸šåŠ¡é€»è¾‘                              â”‚
â”‚  â””â”€ åé¦ˆæ‰§è¡ŒçŠ¶æ€å’Œç»“æœ                                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **å•ä¸€èŒè´£**ï¼šç”³é¢†è€…ä¸éœ€è¦çŸ¥é“"åšä»€ä¹ˆ"ï¼Œåªéœ€è¦çŸ¥é“"æ€ä¹ˆæ‰§è¡Œ"
2. **å¯å¤ç”¨æ€§**ï¼šåŒä¸€ä¸ªç”³é¢†è€…å¯ä»¥å¤„ç†å„ç§ä¸åŒçš„ä»»åŠ¡
3. **è§£è€¦åˆ**ï¼šä»»åŠ¡é€»è¾‘å˜åŒ–ä¸å½±å“ç”³é¢†è€…å®ç°
4. **ç±»å‹å®‰å…¨**ï¼šä¸šåŠ¡é€»è¾‘é€šè¿‡ `std::function` å°è£…ï¼Œç¼–è¯‘æœŸç±»å‹æ£€æŸ¥

#### å¯¹æ¯”é”™è¯¯è®¾è®¡

âŒ **é”™è¯¯è®¾è®¡**ï¼šç”³é¢†è€…å†³å®šä¸šåŠ¡é€»è¾‘
```cpp
// ä¸å¥½çš„è®¾è®¡ï¼šç”³é¢†è€…éœ€è¦çŸ¥é“å…·ä½“åšä»€ä¹ˆ
class DataProcessorClaimer : public Claimer {
    void process_task(const Task &task) override {
        // ç”³é¢†è€…è‡ªå·±å†³å®šå¦‚ä½•å¤„ç†ä»»åŠ¡ - è¿™æ˜¯é”™çš„ï¼
        load_data(task.metadata["file"]);
        process_data();
        save_result();
    }
};
```

âœ… **æ­£ç¡®è®¾è®¡**ï¼šä»»åŠ¡æºå¸¦ä¸šåŠ¡é€»è¾‘
```cpp
// å¥½çš„è®¾è®¡ï¼šä»»åŠ¡æœ¬èº«å®šä¹‰ä¸šåŠ¡é€»è¾‘
auto task = platform->task_builder()
    .handler([](Task &task, const auto &input) {
        // å‘å¸ƒè€…åœ¨è¿™é‡Œå®šä¹‰ä»»åŠ¡è¦åšä»€ä¹ˆ
        load_data(input.at("file"));
        process_data();
        save_result();
        return TaskResult{};
    })
    .build();

// ç”³é¢†è€…åªè´Ÿè´£æ‰§è¡Œ
claimer->execute_task(task.id(), "/data/input.csv");
```

### ä»»åŠ¡å®šä¹‰

ä»»åŠ¡ï¼ˆTaskï¼‰æ˜¯å¹³å°çš„æ ¸å¿ƒå®ä½“ï¼Œä»£è¡¨éœ€è¦å¤„ç†çš„å·¥ä½œå•å…ƒã€‚

> ğŸ“š **å®Œæ•´ API å®šä¹‰è¯·å‚é˜… [API.md](API.md#ä»»åŠ¡ç±»-task)**

#### æ ¸å¿ƒå±æ€§æ¦‚è§ˆ

| å±æ€§åˆ†ç±» | ä¸»è¦å±æ€§ | è¯´æ˜ |
|---------|---------|------|
| **åŸºæœ¬ä¿¡æ¯** | `id`, `title`, `description` | ä»»åŠ¡æ ‡è¯†å’Œæè¿° |
| **è°ƒåº¦å±æ€§** | `priority`, `category`, `tags` | ç”¨äºä»»åŠ¡åˆ†ç±»å’Œä¼˜å…ˆçº§è°ƒåº¦ |
| **è§’è‰²å…³ç³»** | `publisher_id`, `claimer_id`, `required_role` | å‘å¸ƒè€…å’Œç”³é¢†è€…å…³ç³» |
| **çŠ¶æ€è¿½è¸ª** | `status`, `progress` | ä»»åŠ¡å½“å‰çŠ¶æ€å’Œè¿›åº¦ |
| **æ—¶é—´ä¿¡æ¯** | `created_at`, `deadline`, `completed_at` | æ—¶é—´èŠ‚ç‚¹è®°å½• |
| **å¥–åŠ±æœºåˆ¶** | `reward_points`, `reward_type` | èµé‡‘æ¦œç‰¹è‰² |

#### å…³é”®è®¾è®¡ï¼šä¸šåŠ¡é€»è¾‘æºå¸¦

ä»»åŠ¡æºå¸¦ `TaskHandler` å¤„ç†å‡½æ•°ï¼Œç”±å‘å¸ƒè€…å®šä¹‰å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼š

```cpp
using TaskHandler = std::function<tl::expected<TaskResult, std::string>(
    Task &task,              // ä»»åŠ¡å¯¹è±¡æœ¬èº«ï¼ˆç”¨äºæ›´æ–°è¿›åº¦ç­‰ï¼‰
    const std::string &input // è¾“å…¥æ•°æ®ï¼ˆæ ¼å¼ç”±ç”¨æˆ·å®šä¹‰ï¼‰
)>;
```

> **è®¾è®¡è¯´æ˜**ï¼š`input` å‚æ•°ä½¿ç”¨ç®€å•çš„ `std::string`ï¼Œç”¨æˆ·å¯ä» æ®éœ€è¦ä¼ å…¥æ–‡ä»¶è·¯å¾„ã€JSON å­—ç¬¦ä¸²ã€é…ç½®æ–‡æœ¬ç­‰ä»»æ„æ ¼å¼ï¼Œåœ¨ handler å†…è‡ªè¡Œè§£æã€‚

#### ä»»åŠ¡ä¸šåŠ¡é€»è¾‘å®šä¹‰ç¤ºä¾‹

```cpp
// ç¤ºä¾‹ 1ï¼šç›´æ¥ä½¿ç”¨æ–‡ä»¶è·¯å¾„
auto task1 = platform->task_builder()
    .title("æ•°æ®å¤„ç†ä»»åŠ¡")
    .priority(5)
    .handler([](Task &task, const std::string &input) -> tl::expected<TaskResult, std::string> {
        // input ç›´æ¥æ˜¯æ–‡ä»¶è·¯å¾„
        task.set_progress(10);
        auto data = load_file(input);
        
        task.set_progress(50);
        auto result = process_data(data);
        
        task.set_progress(100);
        return TaskResult{true, "å¤„ç†å®Œæˆ"};
    })
    .build();

// è°ƒç”¨æ—¶
claimer->execute_task(task1->id(), "/data/input.csv");

// ç¤ºä¾‹ 2ï¼šä½¿ç”¨ JSON å­—ç¬¦ä¸²ä¼ é€’å¤æ‚å‚æ•°
auto task2 = platform->task_builder()
    .title("å¤æ‚åˆ†æä»»åŠ¡")
    .handler([](Task &task, const std::string &input) -> tl::expected<TaskResult, std::string> {
        // æŒ‰éœ€è§£æ JSON
        auto config = nlohmann::json::parse(input);
        std::string file_path = config["file_path"];
        int batch_size = config.value("batch_size", 100);
        
        // ... ä¸šåŠ¡é€»è¾‘
        return TaskResult{true, "åˆ†æå®Œæˆ"};
    })
    .build();

// è°ƒç”¨æ—¶ä¼ å…¥ JSON å­—ç¬¦ä¸²
claimer->execute_task(task2->id(), R"({"file_path": "/data/input.csv", "batch_size": 50})");
```

#### ä»»åŠ¡çŠ¶æ€ï¼ˆTaskStatusï¼‰

ä»»åŠ¡åœ¨ç”Ÿå‘½å‘¨æœŸä¸­ä¼šç»å†ä»¥ä¸‹çŠ¶æ€ï¼š

| çŠ¶æ€ | æšä¸¾å€¼ | æè¿° | å¯è½¬æ¢åˆ° |
|------|--------|------|----------|
| **å¾…å‘å¸ƒ** | `Draft` | ä»»åŠ¡å·²åˆ›å»ºï¼Œå°šæœªå‘å¸ƒåˆ°å¹³å° | Published |
| **å·²å‘å¸ƒ** | `Published` | ä»»åŠ¡å·²å‘å¸ƒï¼Œç­‰å¾…ç”³é¢† | Claimed, Cancelled |
| **å·²ç”³é¢†** | `Claimed` | å·²è¢«å¤„ç†è€…ç”³é¢†ï¼Œå‡†å¤‡å¼€å§‹ | Processing, Abandoned |
| **å¤„ç†ä¸­** | `Processing` | æ­£åœ¨æ‰§è¡Œå¤„ç† | Paused, Completed, Failed |
| **æš‚åœ** | `Paused` | æš‚æ—¶åœæ­¢å¤„ç† | Processing, Abandoned |
| **å·²å®Œæˆ** | `Completed` | ä»»åŠ¡æˆåŠŸå®Œæˆ | - |
| **å¤±è´¥** | `Failed` | ä»»åŠ¡å¤„ç†å¤±è´¥ | Published, Abandoned |
| **å·²å–æ¶ˆ** | `Cancelled` | å‘å¸ƒè€…å–æ¶ˆä»»åŠ¡ | - |
| **å·²æ”¾å¼ƒ** | `Abandoned` | ç”³é¢†è€…æ”¾å¼ƒä»»åŠ¡ | Published |

#### çŠ¶æ€è½¬æ¢å›¾

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Draft   â”‚
                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Published â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚                   â”‚
         â†“                        â†“                   â”‚
    Cancelled                 Claimed â”€â”€â”€â”€â”€â†’ Abandoned â”€â”˜
                                  â”‚                   â†‘
                                  â†“                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Processing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                             â”‚                   â”‚
    â†“                             â†“                   â”‚
 Paused â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Completed / Failed â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Processing â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜**ï¼š
- `Paused` å¯ä»¥æ¢å¤åˆ° `Processing`
- `Failed` å¯ä»¥é‡æ–°å‘å¸ƒå› `Published` æˆ–æ ‡è®°ä¸º `Abandoned`
- `Abandoned` ä»»åŠ¡å¯é‡æ–°å‘å¸ƒå› `Published`

### è§’è‰²å®šä¹‰

| è§’è‰² | èŒè´£ | åŠŸèƒ½ |
|------|------|------|
| **å‘å¸ƒè€…** | åˆ›å»ºä»»åŠ¡ | å‘å¸ƒã€åˆ†æ´¾ã€ç›‘æ§ä»»åŠ¡ |
| **ç”³é¢†è€…** | å¤„ç†ä»»åŠ¡ | ç”³é¢†ã€æ‰§è¡Œã€åé¦ˆçŠ¶æ€ |
| **åˆ†æ´¾è€…** | æŒ‡å®šå¤„ç†è€… | ç²¾å‡†åˆ†é…ä»»åŠ¡ç»™ç‰¹å®šç”³é¢†è€… |

### ç”³é¢†è€…å®šä¹‰ï¼ˆClaimerï¼‰

ç”³é¢†è€…ï¼ˆClaimerï¼‰æ˜¯ä»»åŠ¡çš„å®é™…æ‰§è¡Œè€…ï¼Œè´Ÿè´£ä»å¹³å°ç”³é¢†å¹¶å¤„ç†ä»»åŠ¡ã€‚

> ğŸ“š **å®Œæ•´ API å®šä¹‰è¯·å‚é˜… [API.md](API.md#ç”³é¢†è€…ç±»-claimer)**

#### æ ¸å¿ƒå±æ€§æ¦‚è§ˆ

| å±æ€§åˆ†ç±» | ä¸»è¦å±æ€§ | è¯´æ˜ |
|---------|---------|------|
| **åŸºæœ¬ä¿¡æ¯** | `id`, `name`, `role` | ç”³é¢†è€…æ ‡è¯† |
| **èƒ½åŠ›ä¿¡æ¯** | `skills`, `categories`, `max_concurrent_tasks` | å¤„ç†èƒ½åŠ› |
| **çŠ¶æ€ä¿¡æ¯** | `status`, `active_task_count` | å½“å‰çŠ¶æ€ |
| **ç»Ÿè®¡ä¿¡æ¯** | `total_completed`, `success_rate`, `reputation_points` | å†å²ç»Ÿè®¡ |

#### ç”³é¢†è€…çŠ¶æ€ï¼ˆClaimerStatusï¼‰

| çŠ¶æ€ | æšä¸¾å€¼ | æè¿° |
|------|--------|------|
| **ç©ºé—²** | `Idle` | å¯ä»¥ç”³é¢†æ–°ä»»åŠ¡ |
| **å¿™ç¢Œ** | `Busy` | å·²è¾¾åˆ°æœ€å¤§å¹¶å‘ä»»åŠ¡æ•° |
| **ç¦»çº¿** | `Offline` | æš‚æ—¶ä¸å¯ç”¨ |
| **æš‚åœ** | `Paused` | æš‚åœæ¥å—æ–°ä»»åŠ¡ |

#### æ ¸å¿ƒæ–¹æ³•æ¦‚è§ˆ

```cpp
class Claimer {
public:
    // ä»»åŠ¡ç”³é¢† - å››ç§æ–¹å¼
    tl::expected<std::shared_ptr<Task>, Error> claim_task(const TaskId &task_id);      // æŒ‡å®šç”³é¢†
    tl::expected<std::shared_ptr<Task>, Error> claim_next_task();                       // é˜Ÿåˆ—ç”³é¢†
    tl::expected<std::shared_ptr<Task>, Error> claim_matching_task();                   // åŒ¹é…ç”³é¢†
    std::vector<std::shared_ptr<Task>> claim_tasks_to_capacity();                       // æ‰¹é‡ç”³é¢†
    
    // ä»»åŠ¡æ‰§è¡Œ
    tl::expected<void, Error> execute_task(const TaskId &task_id, const std::string &input = "");
    
    // çŠ¶æ€ç®¡ç†
    Claimer &set_status(ClaimerStatus status);
    bool can_claim_more() const noexcept;
};
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// åˆ›å»ºç”³é¢†è€…
auto claimer = std::make_shared<Claimer>("worker-001", "Alice");
claimer->set_role("DataProcessor")
       .add_skill("data_analysis")
       .add_skill("machine_learning")
       .set_max_concurrent(5);

// ç›‘å¬ä»»åŠ¡åˆ†é…äº‹ä»¶
claimer->sig_task_assigned().connect([](const std::shared_ptr<Task> &task) {
    std::cout << "New task assigned: " << task->title() << std::endl;
});

// ç”³é¢†å¹¶æ‰§è¡Œä»»åŠ¡
auto result = claimer->claim_next_task();
if (result) {
    auto task = result.value();
    claimer->execute_task(task->id(), "/data/input.csv");
}
```

### ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ

1. **å¾…å‘å¸ƒ** â†’ ä»»åŠ¡åˆ›å»ºåˆå§‹çŠ¶æ€
2. **å·²å‘å¸ƒ** â†’ ä»»åŠ¡è¿›å…¥å¹³å°ï¼Œç­‰å¾…ç”³é¢†
3. **å·²ç”³é¢†** â†’ ç”³é¢†è€…å¼€å§‹å¤„ç†
4. **å¤„ç†ä¸­** â†’ ä»»åŠ¡æ‰§è¡Œé˜¶æ®µï¼Œå®šæœŸåé¦ˆçŠ¶æ€
5. **å·²å®Œæˆ** â†’ ä»»åŠ¡å¤„ç†å®Œæˆï¼Œåé¦ˆæœ€ç»ˆç»“æœ

### äº¤äº’æµç¨‹å›¾

ä»¥ä¸‹æ³³é“å›¾å±•ç¤ºäº†ä»»åŠ¡ä»å‘å¸ƒåˆ°å®Œæˆçš„å®Œæ•´äº¤äº’æµç¨‹ï¼š

```mermaid
sequenceDiagram
    actor Publisher as å‘å¸ƒè€…
    participant Platform as ä»»åŠ¡å¹³å°
    participant Task as ä»»åŠ¡å¯¹è±¡
    actor Claimer as ç”³é¢†è€…
    participant WebUI as Webç›‘æ§

    %% ä»»åŠ¡å‘å¸ƒæµç¨‹
    Publisher->>Platform: åˆ›å»ºä»»åŠ¡
    Platform->>Task: å®ä¾‹åŒ– Task
    Publisher->>Task: è®¾ç½®å±æ€§(title, priority, description)
    Publisher->>Platform: publish_task()
    Task->>Task: çŠ¶æ€: Draft â†’ Published
    Task-->>Publisher: sig_published ä¿¡å·
    Task-->>WebUI: è®°å½•æ—¥å¿—
    
    %% ä»»åŠ¡ç”³é¢†æµç¨‹
    Claimer->>Platform: æŸ¥è¯¢å¯ç”³é¢†ä»»åŠ¡
    Platform-->>Claimer: è¿”å›ä»»åŠ¡åˆ—è¡¨
    Claimer->>Platform: claim_task(task_id)
    Platform->>Task: æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
    Task->>Task: çŠ¶æ€: Published â†’ Claimed
    Task-->>Claimer: sig_claimed ä¿¡å·
    Task-->>Publisher: sig_claimed ä¿¡å·
    Task-->>WebUI: è®°å½•ç”³é¢†æ—¥å¿—
    Platform-->>Claimer: è¿”å› TaskReference
    
    %% ä»»åŠ¡å¤„ç†æµç¨‹
    Claimer->>Task: start_task()
    Task->>Task: çŠ¶æ€: Claimed â†’ Processing
    Task-->>Claimer: sig_started ä¿¡å·
    Task-->>Publisher: sig_started ä¿¡å·
    Task-->>WebUI: è®°å½•å¼€å§‹æ—¥å¿—
    
    %% è¿›åº¦æ›´æ–°æµç¨‹
    loop å¤„ç†è¿‡ç¨‹
        Claimer->>Task: update_progress(50)
        Task-->>Claimer: sig_progress_updated ä¿¡å·
        Task-->>Publisher: sig_progress_updated ä¿¡å·
        Task-->>WebUI: å®æ—¶æ›´æ–°è¿›åº¦
    end
    
    %% ä»»åŠ¡å®Œæˆæµç¨‹
    Claimer->>Task: complete_task(result)
    Task->>Task: çŠ¶æ€: Processing â†’ Completed
    Task-->>Claimer: sig_completed ä¿¡å·
    Task-->>Publisher: sig_completed ä¿¡å·
    Task-->>WebUI: è®°å½•å®Œæˆæ—¥å¿—
    Platform->>Claimer: æ›´æ–°ç»Ÿè®¡ä¿¡æ¯(reputation_points++)
    
    %% å¼‚å¸¸æµç¨‹ï¼ˆå¯é€‰ï¼‰
    Note over Claimer,Task: å¼‚å¸¸æƒ…å†µ
    alt ä»»åŠ¡å¤±è´¥
        Claimer->>Task: fail_task(reason)
        Task->>Task: çŠ¶æ€: Processing â†’ Failed
        Task-->>Publisher: sig_failed ä¿¡å·
        Task-->>WebUI: è®°å½•å¤±è´¥æ—¥å¿—
    else ä»»åŠ¡æ”¾å¼ƒ
        Claimer->>Task: abandon_task(reason)
        Task->>Task: çŠ¶æ€: Claimed/Processing â†’ Abandoned
        Task-->>Publisher: sig_task_abandoned ä¿¡å·
        Task-->>WebUI: è®°å½•æ”¾å¼ƒæ—¥å¿—
        Task->>Task: çŠ¶æ€: Abandoned â†’ Published
    end
    
    %% Webç›‘æ§å›æ”¾
    WebUI->>WebUI: æ—¶é—´å›æ”¾åŠŸèƒ½
    Note over WebUI: æ”¯æŒæŸ¥çœ‹å®Œæ•´äº¤äº’å†å²
```

**æµç¨‹è¯´æ˜**ï¼š

1. **ä»»åŠ¡å‘å¸ƒé˜¶æ®µ**ï¼šå‘å¸ƒè€…åˆ›å»ºä»»åŠ¡å¹¶å‘å¸ƒåˆ°å¹³å°ï¼Œè§¦å‘ `sig_published` ä¿¡å·
2. **ä»»åŠ¡ç”³é¢†é˜¶æ®µ**ï¼šç”³é¢†è€…æŸ¥è¯¢å¹¶ç”³é¢†ä»»åŠ¡ï¼Œè§¦å‘ `sig_claimed` ä¿¡å·é€šçŸ¥å‘å¸ƒè€…å’Œç”³é¢†è€…
3. **ä»»åŠ¡å¤„ç†é˜¶æ®µ**ï¼šç”³é¢†è€…å¼€å§‹å¤„ç†å¹¶å®šæœŸæ›´æ–°è¿›åº¦ï¼Œé€šè¿‡ `sig_progress_updated` å®æ—¶åé¦ˆ
4. **ä»»åŠ¡å®Œæˆé˜¶æ®µ**ï¼šæˆåŠŸå®Œæˆè§¦å‘ `sig_completed` ä¿¡å·ï¼Œç³»ç»Ÿæ›´æ–°ç”³é¢†è€…å£°æœ›å€¼
5. **å¼‚å¸¸å¤„ç†**ï¼šæ”¯æŒä»»åŠ¡å¤±è´¥æˆ–æ”¾å¼ƒï¼Œæ”¾å¼ƒåä»»åŠ¡é‡æ–°å›åˆ°å·²å‘å¸ƒçŠ¶æ€ç­‰å¾…å…¶ä»–ç”³é¢†è€…
6. **Webç›‘æ§**ï¼šå…¨ç¨‹è®°å½•æ—¥å¿—ï¼Œæ”¯æŒæ—¶é—´å›æ”¾æŸ¥çœ‹å®Œæ•´äº¤äº’å†å²

*æ³¨ï¼šå›¾ä¸­è™šçº¿ç®­å¤´(`-->>`)è¡¨ç¤ºä¿¡å·æ§½çš„å¼‚æ­¥é€šçŸ¥ï¼Œå®çº¿ç®­å¤´(`->>`)è¡¨ç¤ºç›´æ¥æ–¹æ³•è°ƒç”¨*

## ğŸ’¡ ä¸»è¦ç‰¹æ€§è¯¦è§£

### å¤šä¼˜å…ˆçº§è°ƒåº¦

æ”¯æŒåŠ¨æ€è®¾ç½®å’Œè°ƒæ•´ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œç¡®ä¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼˜å…ˆå¤„ç†ï¼š

- **å®æ—¶è°ƒæ•´**ï¼šå¯åœ¨ä»»åŠ¡å¤„ç†å‰åè°ƒæ•´ä¼˜å…ˆçº§
- **å…¬å¹³è°ƒåº¦**ï¼šç›¸åŒä¼˜å…ˆçº§ä»»åŠ¡æŒ‰ FIFO å¤„ç†
- **ä¼˜å…ˆçº§èŒƒå›´**ï¼šæ”¯æŒè‡ªå®šä¹‰ä¼˜å…ˆçº§æ•°å€¼èŒƒå›´

### å¹¶å‘å¤„ç†

- æ”¯æŒå¤šä¸ªç”³é¢†è€…åŒæ—¶å¤„ç†ä¸åŒä»»åŠ¡
- çº¿ç¨‹å®‰å…¨çš„ä»»åŠ¡åˆ†é…å’ŒçŠ¶æ€åŒæ­¥
- è‡ªåŠ¨å¤„ç†å¹¶å‘å†²çªå’Œèµ„æºç«äº‰

## ğŸ” çº¿ç¨‹å®‰å…¨è®¾è®¡

### æ ¸å¿ƒåŸåˆ™

xswl-youdidit è®¾è®¡ä¸º**å®Œå…¨çº¿ç¨‹å®‰å…¨**çš„åº“ï¼Œæ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ— é”å¹¶å‘è®¿é—®ã€‚é‡‡ç”¨ä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

1. **ç»†ç²’åº¦é”å®š**ï¼šä½¿ç”¨æœ€å°ç²’åº¦çš„é”æ¥ä¿æŠ¤å…±äº«æ•°æ®ï¼Œé™ä½é”ç«äº‰
2. **è¯»å†™åˆ†ç¦»**ï¼šå…³é”®æ•°æ®ç»“æ„ä½¿ç”¨ `std::shared_mutex` å…è®¸å¹¶å‘è¯»å–
3. **åŸå­æ“ä½œ**ï¼šé’ˆå¯¹ç®€å•æ•°æ®ç±»å‹ä¼˜å…ˆä½¿ç”¨åŸå­æ“ä½œé¿å…é”å¼€é”€
4. **ä¿¡å·å®‰å…¨**ï¼šä¿¡å·æ§½æœºåˆ¶æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯è·¨çº¿ç¨‹ä½¿ç”¨

### ä¿æŠ¤æœºåˆ¶è¯¦è§£

#### ä»»åŠ¡ï¼ˆTaskï¼‰çº¿ç¨‹å®‰å…¨

```cpp
class Task {
private:
    // ä¿æŠ¤çŠ¶æ€å’Œè¿›åº¦çš„è¯»å†™é”
    mutable std::shared_mutex state_mutex_;
    
    // ä¿æŠ¤å…ƒæ•°æ®å’Œç»“æœçš„äº’æ–¥é”
    mutable std::mutex data_mutex_;
    
    // åŸå­æ“ä½œçš„ç®€å•å±æ€§
    std::atomic<int> progress_{0};           // åŸå­è¿›åº¦æ›´æ–°
    std::atomic<TaskStatus> status_;         // åŸå­çŠ¶æ€
    
public:
    // çº¿ç¨‹å®‰å…¨çš„è¯»å–æ–¹æ³•
    TaskStatus status() const noexcept {
        // ç›´æ¥è¯»å–åŸå­å˜é‡ï¼Œæ— éœ€åŠ é”
        return status_.load(std::memory_order_acquire);
    }
    
    // çº¿ç¨‹å®‰å…¨çš„å†™å…¥æ–¹æ³•
    Task &set_status(TaskStatus new_status) {
        // ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤çŠ¶æ€è½¬æ¢é€»è¾‘
        {
            std::unique_lock<std::mutex> lock(state_mutex_);
            
            // éªŒè¯çŠ¶æ€è½¬æ¢æœ‰æ•ˆæ€§
            if (!is_valid_transition(status_, new_status)) {
                throw std::invalid_argument("Invalid status transition");
            }
            
            auto old_status = status_.load();
            status_.store(new_status, std::memory_order_release);
            
            // è§¦å‘ä¿¡å·ï¼ˆåœ¨é”å†…è¿›è¡Œä»¥ä¿è¯é¡ºåºæ€§ï¼‰
            sig_status_changed_(new_status);
        }
        
        return *this;
    }
    
    // çº¿ç¨‹å®‰å…¨çš„è¿›åº¦æ›´æ–°
    Task &set_progress(int progress) {
        if (progress < 0 || progress > 100) {
            throw std::invalid_argument("Progress must be between 0 and 100");
        }
        
        // åŸå­æ“ä½œï¼Œæ— éœ€æ˜¾å¼åŠ é”
        int old_progress = progress_.exchange(progress, std::memory_order_acq_rel);
        
        // åªåœ¨è¿›åº¦å˜åŒ–æ—¶è§¦å‘ä¿¡å·
        if (old_progress != progress) {
            sig_progress_updated_(progress);
        }
        
        return *this;
    }
    
    // çº¿ç¨‹å®‰å…¨çš„å…ƒæ•°æ®è®¿é—®
    std::string get_metadata(const std::string &key) const {
        std::shared_lock<std::shared_mutex> lock(data_mutex_);
        auto it = metadata.find(key);
        if (it != metadata.end()) {
            return it->second;
        }
        return "";
    }
    
    // æ‰¹é‡å…ƒæ•°æ®è¯»å–ï¼ˆä½¿ç”¨å…±äº«é”å…è®¸å¹¶å‘è¯»ï¼‰
    std::map<std::string, std::string> get_all_metadata() const {
        std::shared_lock<std::shared_mutex> lock(data_mutex_);
        return metadata;  // è¿”å›å‰¯æœ¬
    }
    
    // å…ƒæ•°æ®æ›´æ–°
    Task &set_metadata(const std::string &key, const std::string &value) {
        {
            std::unique_lock<std::shared_mutex> lock(data_mutex_);
            metadata[key] = value;
        }
        return *this;
    }
};
```

#### ç”³é¢†è€…ï¼ˆClaimerï¼‰çº¿ç¨‹å®‰å…¨

```cpp
class Claimer {
private:
    // ä¿æŠ¤ç”³é¢†è€…çŠ¶æ€çš„è¯»å†™é”
    mutable std::shared_mutex claimer_state_mutex_;
    
    // ä¿æŠ¤ä»»åŠ¡åˆ—è¡¨çš„äº’æ–¥é”
    mutable std::shared_mutex tasks_mutex_;
    
    // åŸå­æ“ä½œçš„ç®€å•å±æ€§
    std::atomic<ClaimerStatus> status_{ClaimerStatus::Idle};
    std::atomic<int> active_task_count_{0};
    
public:
    // çº¿ç¨‹å®‰å…¨çš„ä»»åŠ¡ç”³é¢†
    tl::expected<TaskReference, Error> claim_task(const TaskId &task_id) {
        std::unique_lock<std::shared_mutex> lock(tasks_mutex_);
        
        // æ£€æŸ¥å½“å‰ä»»åŠ¡æ•°æ˜¯å¦è¶…é™
        if (active_task_count_.load() >= max_concurrent_tasks_) {
            status_.store(ClaimerStatus::Busy);
            return tl::unexpected(Error("Too many active tasks"));
        }
        
        // æ·»åŠ åˆ°å·²ç”³é¢†ä»»åŠ¡åˆ—è¡¨
        claimed_tasks_.push_back(task_id);
        active_task_count_.fetch_add(1, std::memory_order_release);
        
        // è§¦å‘ä¿¡å·
        sig_task_assigned_(task_id);
        
        return TaskReference(task_id);
    }
    
    // çº¿ç¨‹å®‰å…¨çš„è·å–æ´»è·ƒä»»åŠ¡åˆ—è¡¨
    std::vector<TaskId> get_active_tasks() const {
        std::shared_lock<std::shared_mutex> lock(tasks_mutex_);
        return claimed_tasks_;  // è¿”å›å‰¯æœ¬
    }
    
    // çº¿ç¨‹å®‰å…¨çš„ä»»åŠ¡å®Œæˆï¼ˆåŸå­æ›´æ–°è®¡æ•°ï¼‰
    tl::expected<void, Error> complete_task(const TaskId &task_id) {
        {
            std::unique_lock<std::shared_mutex> lock(tasks_mutex_);
            // ä»åˆ—è¡¨ä¸­ç§»é™¤
            auto it = std::find(claimed_tasks_.begin(), claimed_tasks_.end(), task_id);
            if (it != claimed_tasks_.end()) {
                claimed_tasks_.erase(it);
            }
        }
        
        // æ›´æ–°åŸå­è®¡æ•°
        active_task_count_.fetch_sub(1, std::memory_order_release);
        
        // æ›´æ–°æˆåŠŸç‡ç»Ÿè®¡
        {
            std::unique_lock<std::mutex> stats_lock(statistics_mutex_);
            total_completed_++;
        }
        
        return {};
    }
};
```

#### ä»»åŠ¡å¹³å°ï¼ˆTaskPlatformï¼‰çº¿ç¨‹å®‰å…¨

```cpp
class TaskPlatform {
private:
    // ä¿æŠ¤ä»»åŠ¡é›†åˆçš„è¯»å†™é”
    mutable std::shared_mutex tasks_pool_mutex_;
    
    // ä¿æŠ¤ç”³é¢†è€…é›†åˆçš„è¯»å†™é”
    mutable std::shared_mutex claimers_mutex_;
    
    // ä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å®¹å™¨
    struct TaskQueue {
        std::priority_queue<Task, std::vector<Task>, TaskComparator> queue;
        mutable std::mutex queue_mutex;
        
        // çº¿ç¨‹å®‰å…¨çš„å…¥é˜Ÿæ“ä½œ
        void enqueue(const Task &task) {
            std::unique_lock<std::mutex> lock(queue_mutex);
            queue.push(task);
            // é€šçŸ¥ç­‰å¾…çš„æ¶ˆè´¹è€…
            cv_.notify_one();
        }
        
        // çº¿ç¨‹å®‰å…¨çš„å‡ºé˜Ÿæ“ä½œ
        tl::expected<Task, Error> try_dequeue() {
            std::unique_lock<std::mutex> lock(queue_mutex);
            if (queue.empty()) {
                return tl::unexpected(Error("Queue is empty"));
            }
            auto task = queue.top();
            queue.pop();
            return task;
        }
        
    private:
        std::condition_variable cv_;
    };
    
    TaskQueue task_queue_;
    std::unordered_map<TaskId, std::shared_ptr<Task>> all_tasks_;
    std::unordered_map<std::string, std::shared_ptr<Claimer>> claimers_;
    
public:
    // çº¿ç¨‹å®‰å…¨çš„ä»»åŠ¡å‘å¸ƒ
    TaskId publish_task(const std::shared_ptr<Task> &task) {
        {
            std::unique_lock<std::shared_mutex> lock(tasks_pool_mutex_);
            all_tasks_[task->id()] = task;
        }
        
        task_queue_.enqueue(*task);
        sig_task_published_(*task);
        
        return task->id();
    }
    
    // çº¿ç¨‹å®‰å…¨çš„ä»»åŠ¡æŸ¥è¯¢
    std::shared_ptr<Task> get_task(const TaskId &task_id) const {
        std::shared_lock<std::shared_mutex> lock(tasks_pool_mutex_);
        auto it = all_tasks_.find(task_id);
        if (it != all_tasks_.end()) {
            return it->second;
        }
        return nullptr;
    }
    
    // çº¿ç¨‹å®‰å…¨çš„ç”³é¢†è€…æ³¨å†Œ
    void register_claimer(const std::shared_ptr<Claimer> &claimer) {
        std::unique_lock<std::shared_mutex> lock(claimers_mutex_);
        claimers_[claimer->id()] = claimer;
    }
};
```

### å¹¶å‘åœºæ™¯ä¿è¯

#### 1. **ä»»åŠ¡çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨è½¬æ¢**

å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä»»åŠ¡çŠ¶æ€æ—¶çš„å¹¶å‘ä¿è¯ï¼š

```mermaid
sequenceDiagram
    actor ThreadA as çº¿ç¨‹ A
    participant Mutex as äº’æ–¥é”
    actor ThreadB as çº¿ç¨‹ B
    actor ThreadC as çº¿ç¨‹ C
    participant Task as Task å¯¹è±¡

    ThreadA->>Mutex: lock() è·å–é”
    ThreadB->>Mutex: lock() ç­‰å¾…é”
    ThreadC->>Mutex: lock() ç­‰å¾…é”
    
    Note over Mutex,Task: çº¿ç¨‹ A æŒæœ‰é”
    ThreadA->>Task: set_status(Processing)
    ThreadA->>Task: sig_trigger() è§¦å‘ä¿¡å·
    ThreadA->>Mutex: unlock() é‡Šæ”¾é”
    
    Note over Mutex,Task: çº¿ç¨‹ B è·å¾—é”
    ThreadB->>Task: set_status(Completed)
    ThreadB->>Task: sig_trigger() è§¦å‘ä¿¡å·
    ThreadB->>Mutex: unlock() é‡Šæ”¾é”
    
    Note over Mutex,Task: çº¿ç¨‹ C è·å¾—é”
    ThreadC->>Task: set_status() è½¬æ¢éªŒè¯
    ThreadC-->>ThreadC: âŒ è½¬æ¢æ— æ•ˆ
    ThreadC->>Mutex: unlock() é‡Šæ”¾é”

    Note over ThreadA,ThreadC: å¹¶å‘ä¿è¯<br/>1. åŸå­æ€§ - ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹<br/>2. æœ‰æ•ˆæ€§æ£€æŸ¥ - æ— æ•ˆè½¬æ¢è¢«æ‹’ç»<br/>3. ä¿¡å·é¡ºåºæ€§ - é”å†…è§¦å‘ä¿¡å·
```

#### 2. **ä»»åŠ¡ç”³é¢†çš„åŸå­æ€§**

ä¸¤ä¸ªç”³é¢†è€…åŒæ—¶ç”³é¢†åŒä¸€ä¸ªä»»åŠ¡çš„å¹¶å‘ä¿è¯ï¼š

```mermaid
sequenceDiagram
    actor Claimer1 as ç”³é¢†è€… 1
    participant Task as Task å¯¹è±¡
    participant Mutex as ç”³é¢†é”
    actor Claimer2 as ç”³é¢†è€… 2

    par å¹¶å‘æ‰§è¡Œ
        Claimer1->>Mutex: lock() ç”³é¢†ä»»åŠ¡
    and
        Claimer2->>Mutex: lock() ç­‰å¾…...
    end
    
    Note over Claimer1,Mutex: ç”³é¢†è€… 1 è·å¾—é”
    Claimer1->>Task: status()
    Task-->>Claimer1: Published âœ“
    Claimer1->>Task: set_status(Claimed)
    Claimer1->>Task: claimer_id = "Claimer-1"
    Claimer1->>Task: sig_claimed() è§¦å‘ä¿¡å·
    Claimer1->>Mutex: unlock()
    
    Note over Claimer2,Mutex: ç”³é¢†è€… 2 è·å¾—é”
    Claimer2->>Task: status()
    Task-->>Claimer2: Claimed (é Published) âŒ
    Claimer2-->>Claimer2: ç”³é¢†å¤±è´¥
    Claimer2->>Mutex: unlock()
    
    Note over Claimer1,Claimer2: ä¿è¯ï¼šå³ä½¿ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ<br/>ä¹Ÿåªæœ‰ä¸€ä¸ªèƒ½æˆåŠŸç”³é¢†
```

#### 3. **è¿›åº¦æ›´æ–°çš„é«˜æ•ˆæ€§**

å¤„ç†ä¸­çš„ä»»åŠ¡é¢‘ç¹æ›´æ–°è¿›åº¦çš„ä¼˜åŒ–ï¼š

```mermaid
timeline
    title åŸå­æ“ä½œ vs äº’æ–¥é”æ€§èƒ½å¯¹æ¯”

    section äº’æ–¥é”æ–¹å¼ (ä½æ•ˆ)
    è·å–é” : é”ç«äº‰ (ç­‰å¾…)
    ä¿®æ”¹è¿›åº¦ : æ‰§è¡Œ set_progress()
    è§¦å‘ä¿¡å· : ä¿¡å·è§¦å‘
    é‡Šæ”¾é” : è§£é”

    section åŸå­æ“ä½œ (é«˜æ•ˆ)
    exchange() : æ— é”æ“ä½œ âš¡
    æ£€æŸ¥å˜åŒ– : åˆ¤æ–­æ˜¯å¦æ”¹å˜
    è§¦å‘ä¿¡å· : ä»…åœ¨å˜åŒ–æ—¶è§¦å‘

    section æ€§èƒ½å·®å¼‚
    é«˜é¢‘æ›´æ–°åœºæ™¯ : åŸå­æ“ä½œä¼˜åŠ¿æ˜æ˜¾ ğŸ“ˆ
    ä½é”ç«äº‰åœºæ™¯ : ä¸¤è€…æ€§èƒ½æ¥è¿‘ â‰ˆ
```

| ç‰¹æ€§ | äº’æ–¥é” | åŸå­æ“ä½œ |
|------|-------|--------|
| **åŠ é”å¼€é”€** | æœ‰ ğŸ”’ | æ—  âš¡ |
| **é”ç«äº‰** | é«˜ | ä½ |
| **å†…å­˜åº** | å®Œå…¨åŒæ­¥ | acq_rel ä¿è¯ |
| **é¢‘ç¹æ›´æ–°** | ä½æ•ˆ | é«˜æ•ˆ âœ“ |
| **é«˜åå** | å—é™ | ä¼˜åŠ¿ |

#### 4. **è¯»å†™åˆ†ç¦»çš„é«˜æ•ˆå¹¶å‘è¯»**

Web ç›‘æ§å·¥å…·é¢‘ç¹è¯»å–ã€ç”³é¢†è€…å®æ—¶æ›´æ–°çš„å¹¶å‘åœºæ™¯ï¼š

```mermaid
graph TB
    subgraph ReadersGroup["ğŸ“Š å¤šä¸ªè¯»è€…ï¼ˆå¹¶å‘ï¼‰"]
        Reader1["WebUI ç›‘æ§<br/>è¯»å…ƒæ•°æ®"]
        Reader2["æ—¥å¿—ç³»ç»Ÿ<br/>è¯»çŠ¶æ€"]
        Reader3["ç»Ÿè®¡ç»„ä»¶<br/>è¯»è¿›åº¦"]
    end
    
    subgraph Mutex["ğŸ” shared_mutex"]
        SharedLock["è¯»é” (å…±äº«)<br/>å…è®¸å¤šä¸ªè¯»è€…"]
        WriteLock["å†™é” (æ’ä»–)<br/>é˜»æ­¢è¯»è€…"]
    end
    
    subgraph WritersGroup["âœï¸ å†™è€…ï¼ˆæ’ä»–ï¼‰"]
        Writer1["ç”³é¢†è€…æ›´æ–°<br/>å…ƒæ•°æ®"]
    end
    
    ReadersGroup -->|è·å–å…±äº«é”| SharedLock
    WritersGroup -->|è·å–ç‹¬å é”| WriteLock
    SharedLock -.->|ä¸é˜»æ­¢å…¶ä»–è¯»è€…| ReadersGroup
    WriteLock -->|é˜»æ­¢è¯»è€…| ReadersGroup
    
    style Mutex fill:#ff9999
    style SharedLock fill:#99cc99
    style WriteLock fill:#ffcc99
```

**å¹¶å‘æ€§èƒ½å¯¹æ¯”ï¼š**

| åœºæ™¯ | äº’æ–¥é” | shared_mutex |
|------|-------|-------------|
| **è¯» + è¯»** | âŒ äº’æ–¥ | âœ“ å¹¶å‘ ğŸš€ |
| **è¯» + å†™** | âŒ äº’æ–¥ | âŒ äº’æ–¥ |
| **å†™ + å†™** | âŒ äº’æ–¥ | âŒ äº’æ–¥ |
| **è¯»å¤šå†™å°‘** | ä½æ•ˆ | é«˜æ•ˆ |

### çº¿ç¨‹å®‰å…¨çš„æœ€ä½³å®è·µ

#### 1. **ä»»åŠ¡å®šä¹‰æ—¶çš„çº¿ç¨‹å®‰å…¨**

```mermaid
flowchart LR
    Start["task_builder()"] --> Handler["å®šä¹‰ handler Lambda"]
    
    Handler --> CheckShared{"è®¿é—®<br/>å…±äº«èµ„æº?"}
    
    CheckShared -->|å¦| Safe["âœ“ å®‰å…¨<br/>æ— éœ€åŠ é”"]
    CheckShared -->|æ˜¯| Lock["æ·»åŠ äº’æ–¥é”<br/>ä¿æŠ¤è®¿é—®"]
    
    Lock --> TaskCall["è°ƒç”¨ Task æ–¹æ³•<br/>set_progress()"]
    Safe --> TaskCall
    
    TaskCall --> SafeNow["âœ“ çº¿ç¨‹å®‰å…¨<br/>Task å†…éƒ¨<br/>æœ‰é”ä¿æŠ¤"]
    
    SafeNow --> Result["è¿”å› TaskResult"]
    
    style Start fill:#e1f5ff
    style Safe fill:#c8e6c9
    style SafeNow fill:#c8e6c9
    style Lock fill:#fff9c4
    style Result fill:#f0f4c3
```

#### 2. **ä¿¡å·æ§½çš„çº¿ç¨‹å®‰å…¨ä½¿ç”¨**

```mermaid
graph TD
    A["ä¿¡å·æ§½è¿æ¥"] --> B{"æ§½å‡½æ•°<br/>åšä»€ä¹ˆ?"}
    
    B -->|è®¿é—®å…±äº«èµ„æº| C["âŒ ç›´æ¥è®¿é—®"]
    B -->|æ›´æ–° UI| D["âŒ ç›´æ¥æ›´æ–° UI"]
    B -->|ç®€å•æ“ä½œ| E["âœ“ å®‰å…¨"]
    
    C --> C1["æ·»åŠ äº’æ–¥é”<br/>ä¿æŠ¤è®¿é—®"]
    D --> D1["æ¨é€åˆ° UI çº¿ç¨‹<br/>å¼‚æ­¥å¤„ç†"]
    
    C1 --> Result["âœ“ å®‰å…¨æ‰§è¡Œ"]
    D1 --> Result
    E --> Result
    
    style A fill:#e3f2fd
    style C fill:#ffcdd2
    style D fill:#ffcdd2
    style E fill:#c8e6c9
    style Result fill:#f0f4c3
```

#### 3. **ç”³é¢†è€…å¹¶å‘å¤„ç†ä»»åŠ¡**

```mermaid
graph TB
    subgraph Threads["å¤šä¸ªå·¥ä½œçº¿ç¨‹"]
        T1["çº¿ç¨‹ 1<br/>Worker-0"]
        T2["çº¿ç¨‹ 2<br/>Worker-1"]
        T3["çº¿ç¨‹ 3<br/>Worker-2"]
        T4["çº¿ç¨‹ 4<br/>Worker-3"]
    end
    
    subgraph Platform["TaskPlatform<br/>çº¿ç¨‹å®‰å…¨"]
        Q["ä¼˜å…ˆçº§é˜Ÿåˆ—<br/>äº’æ–¥é”ä¿æŠ¤"]
        C["ç”³é¢†è€…é›†åˆ<br/>shared_mutex"]
    end
    
    subgraph Tasks["ä»»åŠ¡å¯¹è±¡<br/>åŸå­æ“ä½œ"]
        TK["çŠ¶æ€ã€è¿›åº¦<br/>çº¿ç¨‹å®‰å…¨"]
    end
    
    T1 -->|try_get_next| Q
    T2 -->|claim_task| C
    T3 -->|execute_task| TK
    T4 -->|complete_task| C
    
    style Threads fill:#e8f5e9
    style Platform fill:#fff3e0
    style Tasks fill:#f3e5f5
```

### æ€§èƒ½è€ƒè™‘

| åœºæ™¯ | åŒæ­¥æ–¹å¼ | åŸå›  | æ€§èƒ½å½±å“ |
|------|--------|------|--------|
| çŠ¶æ€è¯»å– | åŸå­æ“ä½œ | `load()` æ— éœ€åŠ é” | å¾ˆå° |
| çŠ¶æ€ä¿®æ”¹ | äº’æ–¥é” | éœ€è¦éªŒè¯è½¬æ¢æœ‰æ•ˆæ€§ | ä¸­ç­‰ |
| è¿›åº¦æ›´æ–° | åŸå­æ“ä½œ | `exchange()` é¢‘ç¹è°ƒç”¨ | å¾ˆå° |
| å…ƒæ•°æ®è¯»å– | å…±äº«é” | å…è®¸å¤šä¸ªè¯»è€… | å¾ˆå° |
| å…ƒæ•°æ®ä¿®æ”¹ | ç‹¬å é” | æ’ä»–æ€§å†™å…¥ | ä¸­ç­‰ |
| ä»»åŠ¡æŸ¥è¯¢ | å…±äº«é” | åªè¯»æ“ä½œ | å¾ˆå° |
| ä»»åŠ¡ç”³é¢† | äº’æ–¥é” | å¿…é¡»æ˜¯åŸå­æ“ä½œ | ä¸­ç­‰ |
| ä¼˜å…ˆçº§é˜Ÿåˆ— | äº’æ–¥é” | å †æ“ä½œéœ€è¦äº’æ–¥ | ä¸­ç­‰ |

### æ½œåœ¨çš„æ­»é”é¿å…

```mermaid
graph TD
    subgraph Unsafe["âŒ å±é™©ï¼šå¯èƒ½æ­»é”"]
        Thread1["çº¿ç¨‹ A"]
        Thread2["çº¿ç¨‹ B"]
        A["è·å–é” A"]
        B["è·å–é” B"]
        AA["ç­‰å¾…é” B"]
        BB["ç­‰å¾…é” A"]
        
        Thread1 --> A
        Thread2 --> B
        A --> AA
        B --> BB
        AA -.->|æ­»é”| BB
    end
    
    subgraph Safe["âœ“ å®‰å…¨ï¼šä¸€è‡´åŠ é”é¡ºåº"]
        Thread3["çº¿ç¨‹ A"]
        Thread4["çº¿ç¨‹ B"]
        C["è·å–é” A"]
        D["è·å–é” B"]
        CC["é‡Šæ”¾é” B"]
        DD["è·å–é” A"]
        
        Thread3 --> C
        Thread4 -->|ç­‰å¾…é” A| DD
        C --> D
        D --> CC
        CC -.->|æˆåŠŸ| DD
    end
    
    style Unsafe fill:#ffcdd2
    style Safe fill:#c8e6c9
    style AA fill:#ef5350
    style BB fill:#ef5350
```

**åŠ é”é¡ºåºçº¦å®šï¼š**
1. æ€»æ˜¯å…ˆåŠ  `platform_mutex`
2. å†åŠ  `task_mutex`  
3. æœ€ååŠ  `data_mutex`

### å»ºè®®çš„éªŒè¯æ–¹å¼

```mermaid
graph LR
    Start["çº¿ç¨‹å®‰å…¨<br/>éªŒè¯"] --> Tools["é€‰æ‹©éªŒè¯æ–¹å¼"]
    
    Tools --> TSan["ThreadSanitizer<br/>ğŸ” æ£€æµ‹ç«äº‰æ¡ä»¶"]
    Tools --> Stress["å‹åŠ›æµ‹è¯•<br/>âš¡ é•¿æ—¶é—´è¿è¡Œ"]
    Tools --> CI["æŒç»­é›†æˆ<br/>ğŸ”„ è‡ªåŠ¨éªŒè¯"]
    
    TSan --> TCmd["g++ -fsanitize=thread<br/>-g program.cpp"]
    Stress --> SCmd["åˆ›å»º 10 çº¿ç¨‹<br/>å¹¶å‘æ“ä½œ"]
    CI --> CCmd["GitHub Actions<br/>å®šæ—¶è¿è¡Œ"]
    
    TCmd --> TCover["è¦†ç›–æ•°æ®ç«äº‰<br/>å†…å­˜å®‰å…¨é—®é¢˜"]
    SCmd --> SCover["è¦†ç›–æ­»é”<br/>å¹¶å‘åœºæ™¯"]
    CCmd --> CCover["è¦†ç›–å›å½’é—®é¢˜<br/>é•¿æœŸç¨³å®šæ€§"]
    
    TCover --> Result["âœ“ çº¿ç¨‹å®‰å…¨<br/>éªŒè¯å®Œæˆ"]
    SCover --> Result
    CCover --> Result
    
    style Start fill:#e3f2fd
    style Tools fill:#fff3e0
    style Result fill:#c8e6c9
    style TSan fill:#f3e5f5
    style Stress fill:#fce4ec
    style CI fill:#e0f2f1
```

**éªŒè¯å·¥å…·è¯¦è§£ï¼š**

| å·¥å…· | ä½œç”¨ | æ£€æµ‹é¡¹ | è¦†ç›–ç‡ |
|------|------|--------|--------|
| **ThreadSanitizer** | åŠ¨æ€æ£€æµ‹ | ç«äº‰æ¡ä»¶ã€æ­»é” | é«˜ âœ“ |
| **å‹åŠ›æµ‹è¯•** | é•¿æœŸè¿è¡Œ | éšè—ç«äº‰ã€èµ„æºæ³„æ¼ | ä¸­ç­‰ |
| **StaticAnalyzer** | é™æ€åˆ†æ | æ˜æ˜¾é—®é¢˜ | ä½ |
| **ä»£ç å®¡æŸ¥** | äººå·¥æ£€æŸ¥ | é€»è¾‘é—®é¢˜ | é«˜ |

### çº¿ç¨‹å®‰å…¨æ€»ä½“æ¶æ„

```mermaid
graph TB
    subgraph User["ç”¨æˆ·ä»£ç "]
        App["åº”ç”¨ç¨‹åº"]
    end
    
    subgraph Library["xswl-youdidit åº“"]
        subgraph Task["Task ä»»åŠ¡å¯¹è±¡"]
            TS["çŠ¶æ€: åŸå­æ“ä½œ"]
            TP["è¿›åº¦: åŸå­æ“ä½œ"]
            TM["å…ƒæ•°æ®: shared_mutex"]
        end
        
        subgraph Claimer["Claimer ç”³é¢†è€…"]
            CS["çŠ¶æ€: åŸå­æ“ä½œ"]
            CT["ä»»åŠ¡åˆ—è¡¨: shared_mutex"]
        end
        
        subgraph Platform["Platform å¹³å°"]
            PQ["ä»»åŠ¡é˜Ÿåˆ—: mutex"]
            PC["ç”³é¢†è€…é›†åˆ: shared_mutex"]
        end
        
        subgraph Signals["ä¿¡å·æ§½ç³»ç»Ÿ"]
            SG["çº¿ç¨‹å®‰å…¨ä¿¡å·"]
        end
    end
    
    App -->|ä½¿ç”¨| Task
    App -->|ä½¿ç”¨| Claimer
    App -->|ä½¿ç”¨| Platform
    
    Task --> SG
    Claimer --> SG
    Platform --> SG
    
    Task -.->|æŸ¥è¯¢| Platform
    Claimer -.->|æ“ä½œ| Task
    
    style User fill:#e1f5ff
    style Library fill:#f5f5f5
    style Task fill:#fff9c4
    style Claimer fill:#f0f4c3
    style Platform fill:#ffccbc
    style Signals fill:#c8e6c9
```

## ğŸ” ä¿¡å·æ§½æœºåˆ¶è¯¦è§£

é¡¹ç›®é‡‡ç”¨ [xswl-signals](https://github.com/Wang-Jianwei/xswl-signals.git) åº“å®ç°äº‹ä»¶é©±åŠ¨ï¼Œæä¾›ç±»å‹å®‰å…¨çš„ä¿¡å·æ§½æœºåˆ¶ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ï¼Œæ§½å‡½æ•°ç­¾åçµæ´»
- **å‚æ•°é€‚é…**ï¼šæ§½å‡½æ•°å¯æ¥å—æ¯”ä¿¡å·æ›´å°‘çš„å‚æ•°
- **ä¼˜å…ˆçº§è°ƒåº¦**ï¼šæ”¯æŒæŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œæ§½å‡½æ•°
- **å•æ¬¡è¿æ¥**ï¼šæ”¯æŒ `connect_once` ä¸€æ¬¡æ€§å›è°ƒ
- **è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šä½¿ç”¨ `shared_ptr` è‡ªåŠ¨è¿½è¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
- **çº¿ç¨‹å®‰å…¨**ï¼šåŸºç¡€çº¿ç¨‹å®‰å…¨ä¿è¯ï¼Œé€‚åˆä¸€èˆ¬åœºæ™¯

### ä½¿ç”¨æ¨¡å¼

```cpp
// æ¨¡å¼ 1ï¼šLambda è¿æ¥ï¼ˆæœ€å¸¸ç”¨ï¼‰
task->sig_status_changed().connect([](TaskStatus status) {
    std::cout << "Task status: " << status.name() << std::endl;
});

// æ¨¡å¼ 2ï¼šæˆå‘˜å‡½æ•°è¿æ¥ï¼ˆè‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸè¿½è¸ªï¼‰
auto handler = std::make_shared<EventHandler>();
task->sig_completed().connect(handler, &EventHandler::on_task_complete);

// æ¨¡å¼ 3ï¼šä¼˜å…ˆçº§è°ƒåº¦
claimer->sig_progress_updated().connect([](const TaskId &id, int progress) {
    std::cout << "Progress: " << progress << "%" << std::endl;
}, 100);  // ä¼˜å…ˆçº§ä¸º 100

// æ¨¡å¼ 4ï¼šå•æ¬¡æ‰§è¡Œ
task->sig_published().connect_once([](const TaskId &id) {
    std::cout << "Task published first time" << std::endl;
});

// æ¨¡å¼ 5ï¼šè¿æ¥ç®¡ç†ï¼ˆRAII é£æ ¼ï¼‰
{
    xswl::scoped_connection_t conn = task->sig_status_changed().connect([](TaskStatus status) {
        std::cout << "Inside scope" << std::endl;
    });
    
    task->set_status(TaskStatus::Processing);  // è§¦å‘ä¿¡å·
}  // conn ææ„ï¼Œè‡ªåŠ¨æ–­å¼€è¿æ¥

task->set_status(TaskStatus::Completed);  // ä¸ä¼šè§¦å‘ä¹‹å‰çš„å›è°ƒ

// æ¨¡å¼ 6ï¼šæ‰¹é‡ç®¡ç†ï¼ˆè¿æ¥ç»„ï¼‰
xswl::connection_group_t conns;
conns += task->sig_status_changed().connect([](TaskStatus status) { /* ... */ });
conns += task->sig_progress_updated().connect([](int progress) { /* ... */ });

conns.disconnect_all();  // ä¸€æ¬¡æ€§æ–­å¼€æ‰€æœ‰è¿æ¥
```

### ä¿¡å·åˆ—è¡¨

| å¯¹è±¡ | ä¿¡å·å | å‚æ•° | è§¦å‘æ—¶æœº |
|------|--------|------|---------|
| **Task** | `sig_status_changed()` | `TaskStatus` | ä»»åŠ¡çŠ¶æ€å˜åŒ– |
| | `sig_progress_updated()` | `int` | è¿›åº¦æ›´æ–° |
| | `sig_published()` | `TaskId` | ä»»åŠ¡å‘å¸ƒ |
| | `sig_claimed()` | `TaskId, string` | ä»»åŠ¡è¢«ç”³é¢† |
| | `sig_started()` | `TaskId` | å¼€å§‹å¤„ç† |
| | `sig_completed()` | `TaskId, TaskResult` | å¤„ç†å®Œæˆ |
| | `sig_failed()` | `TaskId, string` | å¤„ç†å¤±è´¥ |
| | `sig_priority_changed()` | `int, int` | ä¼˜å…ˆçº§å˜åŒ– (æ—§å€¼, æ–°å€¼) |
| **Claimer** | `sig_task_assigned()` | `shared_ptr<Task>` | ä»»åŠ¡åˆ†æ´¾ç»™ç”³é¢†è€… |
| | `sig_task_started()` | `shared_ptr<Task>` | ç”³é¢†è€…å¼€å§‹ä»»åŠ¡ |
| | `sig_progress_updated()` | `TaskId, int` | ä»»åŠ¡è¿›åº¦æ›´æ–° |
| | `sig_task_completed()` | `shared_ptr<Task>, TaskResult` | ä»»åŠ¡å®Œæˆ |
| | `sig_task_failed()` | `shared_ptr<Task>, string` | ä»»åŠ¡å¤±è´¥ |
| | `sig_task_abandoned()` | `shared_ptr<Task>, string` | ä»»åŠ¡æ”¾å¼ƒ |
| | `sig_status_changed()` | `ClaimerStatus` | ç”³é¢†è€…çŠ¶æ€å˜åŒ– |
| **TaskPlatform** | `sig_task_published()` | `shared_ptr<Task>` | ä»»åŠ¡å‘å¸ƒåˆ°å¹³å° |
| | `sig_task_claimed()` | `shared_ptr<Task>` | ä»»åŠ¡è¢«ç”³é¢† |
| | `sig_task_started()` | `shared_ptr<Task>` | ä»»åŠ¡å¼€å§‹å¤„ç† |
| | `sig_task_completed()` | `shared_ptr<Task>, TaskResult` | ä»»åŠ¡å®Œæˆ |
| | `sig_task_failed()` | `shared_ptr<Task>, string` | ä»»åŠ¡å¤±è´¥ |
| | `sig_task_cancelled()` | `shared_ptr<Task>` | ä»»åŠ¡è¢«å–æ¶ˆ |
| | `sig_claimer_registered()` | `shared_ptr<Claimer>` | ç”³é¢†è€…æ³¨å†Œ |
| | `sig_claimer_unregistered()` | `string` | ç”³é¢†è€…æ³¨é”€ |

> **æ³¨æ„**ï¼šè¡¨æ ¼ä¸­ `shared_ptr<T>` æ˜¯ `const std::shared_ptr<T>&` çš„ç®€å†™ã€‚

## ğŸ” ç›‘æ§ä¸å¯è§†åŒ–

xswl-youdidit æä¾›å®Œæ•´çš„ Web ç›‘æ§ç³»ç»Ÿï¼Œæ”¯æŒå®æ—¶ä»ªè¡¨æ¿ã€äº‹ä»¶æ—¥å¿—ã€æ—¶é—´å›æ”¾å’Œæ€§èƒ½åˆ†æã€‚

> **è¯¦ç»†æ–‡æ¡£**ï¼š
> - [Web ç›‘æ§ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](docs/WEB_MONITORING.md) - æ¶æ„è®¾è®¡ã€éƒ¨ç½²æ¨¡å¼ã€è·¨è¿›ç¨‹é€šä¿¡
> - [Web API æ–‡æ¡£](docs/WEB_API.md) - C++ API å’Œ HTTP REST API å®Œæ•´å‚è€ƒ

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **å®æ—¶ä»ªè¡¨æ¿** | Web UI å±•ç¤ºä»»åŠ¡çŠ¶æ€ã€ç”³é¢†è€…çŠ¶æ€ã€ç³»ç»ŸæŒ‡æ ‡ |
| **äº‹ä»¶æ—¥å¿—** | è®°å½•æ‰€æœ‰ç³»ç»Ÿäº‹ä»¶ï¼Œæ”¯æŒæŸ¥è¯¢å’Œå¯¼å‡º |
| **æ—¶é—´å›æ”¾** | æŸ¥çœ‹ä»»æ„æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€ï¼ˆTime Travel Debuggingï¼‰ |
| **æ€§èƒ½åˆ†æ** | ä»»åŠ¡å¤„ç†æ—¶é—´ã€ç”³é¢†è€…æ•ˆç‡ã€ç³»ç»Ÿååé‡åˆ†æ |
| **æ•°æ®å¯¼å‡º** | JSONã€CSV æ ¼å¼å¯¼å‡ºï¼Œæ”¯æŒç”ŸæˆæŠ¥å‘Š |

### è§£è€¦è®¾è®¡

Web ç›‘æ§ç³»ç»Ÿä¸æ ¸å¿ƒä»»åŠ¡è°ƒåº¦å®Œå…¨è§£è€¦ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TaskPlatform   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  WebDashboard   â”‚  (å¯é€‰ç»„ä»¶)
â”‚  (æ ¸å¿ƒè°ƒåº¦)      â”‚       â”‚  (ç›‘æ§å¯è§†åŒ–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **æŒ‰éœ€å¯ç”¨**ï¼šä¸éœ€è¦ç›‘æ§æ—¶é›¶å¼€é”€
- **æ•…éšœéš”ç¦»**ï¼šç›‘æ§å´©æºƒä¸å½±å“æ ¸å¿ƒä¸šåŠ¡
- **çµæ´»éƒ¨ç½²**ï¼šæ”¯æŒåŒè¿›ç¨‹ã€ç‹¬ç«‹è¿›ç¨‹ã€è¿œç¨‹ç›‘æ§

### å¿«é€Ÿå¼€å§‹

```cpp
// åˆ›å»ºå¹³å°
auto platform = std::make_shared<TaskPlatform>();

// åˆ›å»ºç‹¬ç«‹çš„ Web ä»ªè¡¨æ¿
auto dashboard = std::make_shared<WebDashboard>(platform.get());
dashboard->set_update_interval(1000)
         ->set_max_event_history(10000)
         ->start_server(8080);

// è®¿é—® http://localhost:8080 æŸ¥çœ‹ä»ªè¡¨æ¿
std::cout << "Dashboard: http://localhost:8080" << std::endl;

// è·å–å®æ—¶æŒ‡æ ‡
auto metrics = dashboard->get_metrics();
std::cout << "å®Œæˆç‡: " << metrics.task_completion_rate * 100 << "%" << std::endl;

// æ—¶é—´å›æ”¾
auto replay = dashboard->get_time_replay();
auto snapshot = replay->get_snapshot_at(Timestamp::now() - std::chrono::minutes(30));
```

### éƒ¨ç½²æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **åŒè¿›ç¨‹** | Dashboard ä¸ Platform åœ¨åŒä¸€è¿›ç¨‹ | å¼€å‘ç¯å¢ƒã€å°å‹éƒ¨ç½² |
| **ç‹¬ç«‹è¿›ç¨‹** | Dashboard ä½œä¸ºç‹¬ç«‹ç›‘æ§æœåŠ¡ | ç”Ÿäº§ç¯å¢ƒã€æ•…éšœéš”ç¦» |
| **é›†ä¸­ç›‘æ§** | ä¸€ä¸ª Dashboard ç›‘æ§å¤šä¸ª Platform | åˆ†å¸ƒå¼éƒ¨ç½²ã€ç»Ÿä¸€è¿ç»´ |

> è¯¦ç»†çš„éƒ¨ç½²æ¶æ„å’Œè·¨è¿›ç¨‹é€šä¿¡è®¾è®¡è¯·å‚é˜… [Web ç›‘æ§ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](docs/WEB_MONITORING.md)

## ğŸ“¦ ä¾èµ–åº“

- **tl::optional** - å¯é€‰å€¼å¤„ç†ï¼Œæ”¯æŒç°ä»£ C++ é£æ ¼çš„å¯é€‰ç±»å‹
- **tl::expected** - ä¼˜é›…çš„é”™è¯¯å¤„ç†ï¼Œæä¾› Result ç±»å‹è¯­ä¹‰
- **xswl-signals** - ä¿¡å·æ§½æœºåˆ¶ï¼Œå®ç°ç±»å‹å®‰å…¨çš„äº‹ä»¶ç³»ç»Ÿ

## ğŸ¯ ç°ä»£ C++ ç‰¹æ€§

é¡¹ç›®å……åˆ†åˆ©ç”¨ C++11 åŠæ›´æ–°ç‰¹æ€§ï¼š

| ç‰¹æ€§ | ç”¨é€” |
|------|------|
| **æ™ºèƒ½æŒ‡é’ˆ** | è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œé¿å…æ‰‹åŠ¨ delete |
| **Lambda è¡¨è¾¾å¼** | çµæ´»çš„å›è°ƒå’Œäº‹ä»¶å¤„ç† |
| **Move è¯­ä¹‰** | é«˜æ•ˆçš„èµ„æºè½¬ç§»å’Œé¿å…æ‹·è´ |
| **std::function** | ç±»å‹æ“¦é™¤çš„å‡½æ•°åŒ…è£… |
| **Fluent API** | é“¾å¼è°ƒç”¨ï¼Œæå‡ä»£ç å¯è¯»æ€§ |
| **Builder æ¨¡å¼** | å¤æ‚å¯¹è±¡çš„çµæ´»æ„å»º |
| **Result/Optional** | å‡½æ•°å¼çš„é”™è¯¯å¤„ç† |

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç¤ºä¾‹ï¼ˆFluent API é£æ ¼ï¼‰

```cpp
#include <xswl/youdidit.hpp>
#include <memory>

using namespace xswl::youdidit;

// åˆ›å»ºå¹¶é…ç½®ä»»åŠ¡å¹³å°
auto platform = std::make_shared<TaskPlatform>();
platform->set_log_file("platform.log");

// ä½¿ç”¨ Fluent API å‘å¸ƒä»»åŠ¡ï¼ˆæºå¸¦ä¸šåŠ¡é€»è¾‘ï¼‰
auto task = platform->task_builder()
    .title("Process Data")
    .priority(5)
    .description("å¤„ç†ç”¨æˆ·æ•°æ®")
    .assign_to_role("DataProcessor")
    .handler([](Task &task, const std::string &input) -> tl::expected<TaskResult, std::string> {
        // å‘å¸ƒè€…å®šä¹‰ä»»åŠ¡è¦åšä»€ä¹ˆ
        try {
            // é˜¶æ®µ1ï¼šåŠ è½½æ•°æ®
            task.set_progress(20);
            auto data = load_data(input);  // input å¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„æˆ– JSON å­—ç¬¦ä¸²
            
            // é˜¶æ®µ2ï¼šå¤„ç†æ•°æ®
            task.set_progress(60);
            auto processed = process_data(data);
            
            // é˜¶æ®µ3ï¼šä¿å­˜ç»“æœ
            task.set_progress(90);
            save_result(processed);
            
            // è¿”å›ç»“æœ
            TaskResult result;
            result.success = true;
            result.summary = "Data processed successfully";
            return result;
            
        } catch (const std::exception &e) {
            return tl::unexpected(std::string("Error: ") + e.what());
        }
    })
    .build();

// ç”³é¢†ä»»åŠ¡
auto claimer = std::make_shared<Claimer>("Worker-001");
auto result = claimer->claim_task(task.id());

if (result) {
    // ç”³é¢†è€…åªéœ€æä¾›è¾“å…¥æ•°æ®ï¼Œæ‰§è¡Œä»»åŠ¡å®šä¹‰çš„ä¸šåŠ¡é€»è¾‘
    std::string input = "/data/input.csv";  // è¾“å…¥æ•°æ®ï¼Œå¯ä»¥æ˜¯è·¯å¾„ã€JSON å­—ç¬¦ä¸²ç­‰
    
    auto exec_result = claimer->execute_task(task.id(), input);
    if (exec_result) {
        std::cout << "Task executed successfully!" << std::endl;
    } else {
        std::cerr << "Execution failed: " << exec_result.error() << std::endl;
    }
} else {
    std::cerr << "Failed to claim task: " << result.error() << std::endl;
}
```

### é«˜çº§ç¤ºä¾‹ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰

```cpp
// åˆ›å»ºå¹³å°å’Œå¤„ç†è€…
auto platform = std::make_shared<TaskPlatform>();

// è®¢é˜…ä»»åŠ¡å‘å¸ƒäº‹ä»¶
platform->sig_task_published().connect([](const std::shared_ptr<Task>& task) {
    std::cout << "New task published: " << task->title() << std::endl;
});

// è®¢é˜…ä»»åŠ¡å®Œæˆäº‹ä»¶
platform->sig_task_completed().connect([](const std::shared_ptr<Task>& task, const Result& result) {
    std::cout << "âœ“ Task " << task->id() << " completed" << std::endl;
});

// å‘å¸ƒå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æºå¸¦è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘
for (int i = 0; i < 10; ++i) {
    auto task = platform->task_builder()
        .title("Task " + std::to_string(i))
        .priority(i % 3 + 1)
        .handler([i](Task &task, const std::string &input) -> tl::expected<TaskResult, std::string> {
            // æ¯ä¸ªä»»åŠ¡æœ‰è‡ªå·±ç‰¹å®šçš„å¤„ç†é€»è¾‘
            std::cout << "Executing task " << i << std::endl;
            
            task.set_progress(50);
            // ... å…·ä½“ä¸šåŠ¡å¤„ç† ...
            
            TaskResult result;
            result.summary = "Task " + std::to_string(i) + " completed";
            return result;
        })
        .build();
}

// åˆ›å»ºå¤šä¸ªç”³é¢†è€…ï¼Œå®ƒä»¬åªè´Ÿè´£æ‰§è¡Œï¼Œä¸å†³å®šåšä»€ä¹ˆ
std::vector<std::string> workers = {"Worker-001", "Worker-002", "Worker-003"};
for (const auto &worker_id : workers) {
    auto claimer = std::make_shared<Claimer>(worker_id);
    
    // ç”³é¢†è€…è‡ªåŠ¨å¤„ç†åˆ†é…ç»™å®ƒçš„ä»»åŠ¡
    claimer->sig_task_assigned().connect([claimer](const Task &task) {
        // ä»ä»»åŠ¡å…ƒæ•°æ®ä¸­è·å–è¾“å…¥å‚æ•°
        auto input = task.metadata.at("input");
        
        // æ‰§è¡Œä»»åŠ¡å®šä¹‰çš„ä¸šåŠ¡é€»è¾‘
        claimer->execute_task(task.id(), input);
    });
}
```

### Web ç›‘æ§ç¤ºä¾‹

è¯¦ç»†çš„ Web ç›‘æ§ä½¿ç”¨æ–¹å¼ï¼Œè¯·å‚é˜…ï¼š
- ğŸ“˜ [Web ç›‘æ§è®¾è®¡](docs/WEB_MONITORING.md) - æ¶æ„è®¾è®¡ä¸éƒ¨ç½²æ¨¡å¼
- ğŸ“— [Web API æ–‡æ¡£](docs/WEB_API.md) - å®Œæ•´ API å‚è€ƒ

åŸºç¡€ç¤ºä¾‹ï¼š

```cpp
// åˆ›å»ºå¹³å°
auto platform = std::make_shared<TaskPlatform>();

// åˆ›å»ºç‹¬ç«‹çš„ Web ä»ªè¡¨æ¿ï¼ˆè§£è€¦è®¾è®¡ï¼‰
auto dashboard = std::make_shared<WebDashboard>(platform.get());

// å¯åŠ¨ Web æœåŠ¡å™¨
dashboard->start_server(8080);

// è·å–ä»ªè¡¨æ¿æ•°æ®
std::string data = dashboard->get_dashboard_data();
```

---

**Â© 2026 xswl-youdidit Project** | **MIT License**

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

---

**å¼€å‘è€…**: [Wang-Jianwei](https://github.com/Wang-Jianwei)

**æœ€åæ›´æ–°**: 2026-01-27